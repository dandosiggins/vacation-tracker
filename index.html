<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Off Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Initialize Supabase client
        const SUPABASE_URL = 'https://lktgyhjbookmvcojpiim.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxrdGd5aGpib29rbXZjb2pwaWltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNzgyNTEsImV4cCI6MjA3NDk1NDI1MX0.55SGrmi4UwSrbBZ070dwAsvz7Dlddpa5AZwRV-oMl6k';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function AuthPage() {
          const [isLogin, setIsLogin] = useState(true);
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [loading, setLoading] = useState(false);
          const [message, setMessage] = useState('');

          const handleAuth = async (e) => {
            e.preventDefault();
            setLoading(true);
            setMessage('');

            try {
              if (isLogin) {
                const { data, error } = await supabase.auth.signInWithPassword({
                  email: email,
                  password: password,
                });
                if (error) throw error;
                setMessage('Logged in successfully!');
              } else {
                const { data, error } = await supabase.auth.signUp({
                  email: email,
                  password: password,
                });
                if (error) throw error;
                setMessage('Check your email to confirm your account!');
              }
            } catch (error) {
              setMessage(error.message);
            } finally {
              setLoading(false);
            }
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
              <div className="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
                <div className="text-center mb-6">
                  <h1 className="text-3xl font-bold text-gray-800 mb-2">Time Off Tracker</h1>
                  <p className="text-gray-600">{isLogin ? 'Sign in to your account' : 'Create a new account'}</p>
                </div>

                <div onSubmit={handleAuth} className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input
                      type="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      required
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="you@example.com"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      required
                      minLength="6"
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                    />
                  </div>

                  {message && (
                    <div className={`p-3 rounded-md text-sm ${
                      message.includes('success') || message.includes('Check your email') 
                        ? 'bg-green-50 text-green-800' 
                        : 'bg-red-50 text-red-800'
                    }`}>
                      {message}
                    </div>
                  )}

                  <button
                    onClick={handleAuth}
                    disabled={loading}
                    className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 rounded-md transition disabled:opacity-50"
                  >
                    {loading ? 'Loading...' : (isLogin ? 'Sign In' : 'Sign Up')}
                  </button>
                </div>

                <div className="mt-4 text-center">
                  <button
                    onClick={() => {
                      setIsLogin(!isLogin);
                      setMessage('');
                    }}
                    className="text-indigo-600 hover:text-indigo-700 text-sm"
                  >
                    {isLogin ? "Don't have an account? Sign up" : "Already have an account? Sign in"}
                  </button>
                </div>
              </div>
            </div>
          );
        }

        function App() {
          const [session, setSession] = useState(null);
          const [loading, setLoading] = useState(true);

          useEffect(() => {
            // Check current session
            supabase.auth.getSession().then(({ data: { session } }) => {
              setSession(session);
              setLoading(false);
            });

            // Listen for auth changes
            const {
              data: { subscription },
            } = supabase.auth.onAuthStateChange((_event, session) => {
              setSession(session);
            });

            return () => subscription.unsubscribe();
          }, []);

          if (loading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                <div className="text-center">
                  <div className="text-4xl mb-4">‚è≥</div>
                  <div className="text-lg text-gray-700">Loading...</div>
                </div>
              </div>
            );
          }

          if (!session) {
            return <AuthPage />;
          }

          return <VacationTracker session={session} />;
        }
        
        // Remove the old getUserId function and USER_ID constant
        // const getUserId = () => { ... };
        // const USER_ID = getUserId();
        
        const Calendar = ({size, className}) => <span className={className} style={{fontSize: size}}>üìÖ</span>;
        const Plus = ({size, className}) => <span className={className} style={{fontSize: size}}>‚ûï</span>;
        const Trash2 = ({size, className}) => <span className={className} style={{fontSize: size}}>üóëÔ∏è</span>;
        const Sun = ({size, className}) => <span className={className} style={{fontSize: size}}>‚òÄÔ∏è</span>;
        const User = ({size, className}) => <span className={className} style={{fontSize: size}}>üë§</span>;
        const Star = ({size, className}) => <span className={className} style={{fontSize: size}}>‚≠ê</span>;
        const Clock = ({size, className}) => <span className={className} style={{fontSize: size}}>üïê</span>;
        const Gift = ({size, className}) => <span className={className} style={{fontSize: size}}>üéÅ</span>;
        const ChevronLeft = ({size, className}) => <span className={className} style={{fontSize: size}}>‚óÄ</span>;
        const ChevronRight = ({size, className}) => <span className={className} style={{fontSize: size}}>‚ñ∂</span>;
        const List = ({size, className}) => <span className={className} style={{fontSize: size}}>üìã</span>;
        const CalendarDays = ({size, className}) => <span className={className} style={{fontSize: size}}>üìÜ</span>;

        function VacationTracker({ session }) {
          const HOURS_PER_DAY = 7.75;
          const currentYear = new Date().getFullYear();
          const USER_ID = session.user.id;
          
          const [selectedYear, setSelectedYear] = useState(currentYear);
          const [viewMode, setViewMode] = useState('list');
          const [yearlyData, setYearlyData] = useState({
            [currentYear]: {
              totals: { vacation: 116.25, personal: 23.25, floater: 15.5 },
              timeOff: []
            }
          });
          const [showForm, setShowForm] = useState(false);
          const [formData, setFormData] = useState({
            startDate: '', endDate: '', description: '', type: 'vacation', hours: ''
          });
          const [loading, setLoading] = useState(true);

          // Load data from Supabase when component mounts or year changes
          useEffect(() => {
            if (USER_ID) {
              loadYearData(selectedYear);
            }
          }, [selectedYear, USER_ID]);

          const loadYearData = async (year) => {
            setLoading(true);
            try {
              // Load totals
              const { data: totalsData, error: totalsError } = await supabase
                .from('totals')
                .select('*')
                .eq('user_id', USER_ID)
                .eq('year', year)
                .single();

              // Load time off entries
              const { data: timeOffData, error: timeOffError } = await supabase
                .from('time_off')
                .select('*')
                .eq('user_id', USER_ID)
                .eq('year', year)
                .order('start_date', { ascending: true });

              // Map database fields to match our app format
              const mappedTimeOff = (timeOffData || []).map(item => ({
                id: item.id,
                startDate: item.start_date,
                endDate: item.end_date,
                description: item.description,
                type: item.type,
                hours: parseFloat(item.hours),
                days: item.days
              }));

              const newYearData = {
                totals: totalsData || { vacation: 116.25, personal: 23.25, floater: 15.5 },
                timeOff: mappedTimeOff
              };

              setYearlyData(prev => ({
                ...prev,
                [year]: newYearData
              }));
            } catch (error) {
              console.error('Error loading data:', error);
            } finally {
              setLoading(false);
            }
          };

          const saveTotals = async (year, totals) => {
            try {
              const { data, error } = await supabase
                .from('totals')
                .upsert({
                  user_id: USER_ID,
                  year: year,
                  vacation: totals.vacation,
                  personal: totals.personal,
                  floater: totals.floater
                }, {
                  onConflict: 'user_id,year'
                });
              
              if (error) throw error;
            } catch (error) {
              console.error('Error saving totals:', error);
              alert('Failed to save totals. Please try again.');
            }
          };

          const saveTimeOff = async (year, timeOffEntry) => {
            try {
              const { data, error } = await supabase
                .from('time_off')
                .insert({
                  user_id: USER_ID,
                  year: year,
                  start_date: timeOffEntry.startDate,
                  end_date: timeOffEntry.endDate,
                  description: timeOffEntry.description,
                  type: timeOffEntry.type,
                  hours: timeOffEntry.hours,
                  days: timeOffEntry.days
                })
                .select()
                .single();
              
              if (error) throw error;
              return { ...timeOffEntry, id: data.id };
            } catch (error) {
              console.error('Error saving time off:', error);
              alert('Failed to save time off. Please try again.');
              return null;
            }
          };

          const deleteTimeOffFromDB = async (id) => {
            try {
              const { error } = await supabase
                .from('time_off')
                .delete()
                .eq('id', id);
              
              if (error) throw error;
            } catch (error) {
              console.error('Error deleting time off:', error);
              alert('Failed to delete time off. Please try again.');
            }
          };

          const getCurrentYearData = () => {
            if (!yearlyData[selectedYear]) {
              return { totals: { vacation: 116.25, personal: 23.25, floater: 15.5 }, timeOff: [] };
            }
            return yearlyData[selectedYear];
          };

          const currentData = getCurrentYearData();
          const totals = currentData.totals;
          const timeOff = currentData.timeOff;

          const updateYearData = (updates) => {
            setYearlyData({ ...yearlyData, [selectedYear]: { ...currentData, ...updates } });
          };

          const calculateBusinessDays = (start, end) => {
            let count = 0;
            const current = new Date(start);
            const endDate = new Date(end);
            while (current <= endDate) {
              const dayOfWeek = current.getDay();
              if (dayOfWeek !== 0 && dayOfWeek !== 6) count++;
              current.setDate(current.getDate() + 1);
            }
            return count;
          };

          const usedHours = {
            vacation: timeOff.filter(t => t.type === 'vacation').reduce((sum, t) => sum + t.hours, 0),
            personal: timeOff.filter(t => t.type === 'personal').reduce((sum, t) => sum + t.hours, 0),
            floater: timeOff.filter(t => t.type === 'floater').reduce((sum, t) => sum + t.hours, 0)
          };

          const remainingHours = {
            vacation: totals.vacation - usedHours.vacation,
            personal: totals.personal - usedHours.personal,
            floater: totals.floater - usedHours.floater
          };

          const statHolidays = timeOff.filter(t => t.type === 'stat');

          const handleSubmit = async () => {
            if (formData.startDate && formData.endDate && (formData.hours || formData.type === 'stat')) {
              const days = calculateBusinessDays(formData.startDate, formData.endDate);
              const newTimeOff = {
                startDate: formData.startDate,
                endDate: formData.endDate,
                description: formData.description,
                type: formData.type,
                hours: formData.type === 'stat' ? 0 : parseFloat(formData.hours),
                days: days
              };
              
              // Save to database
              const savedEntry = await saveTimeOff(selectedYear, newTimeOff);
              if (savedEntry) {
                const updatedTimeOff = [...timeOff, savedEntry].sort((a, b) => new Date(a.startDate) - new Date(b.startDate));
                updateYearData({ timeOff: updatedTimeOff });
                setFormData({ startDate: '', endDate: '', description: '', type: 'vacation', hours: '' });
                setShowForm(false);
              }
            }
          };

          const deleteTimeOff = async (id) => {
            await deleteTimeOffFromDB(id);
            updateYearData({ timeOff: timeOff.filter(t => t.id !== id) });
          };

          const updateTotals = async (newTotals) => {
            updateYearData({ totals: newTotals });
            await saveTotals(selectedYear, newTotals);
          };

          const formatDate = (dateString) => {
            if (!dateString) return '';
            // Handle both YYYY-MM-DD and full ISO date formats
            const dateOnly = dateString.split('T')[0]; // Remove time portion if present
            const [year, month, day] = dateOnly.split('-');
            const date = new Date(year, month - 1, day);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
          };

          const getTypeConfig = (type) => {
            const configs = {
              vacation: { label: 'Vacation', color: 'blue', icon: Sun },
              personal: { label: 'Personal', color: 'purple', icon: User },
              floater: { label: 'Floater', color: 'amber', icon: Star },
              stat: { label: 'Stat Holiday', color: 'green', icon: Gift }
            };
            return configs[type];
          };

          const hoursToDays = (hours) => (hours / HOURS_PER_DAY).toFixed(2);

          const handleDateChange = () => {
            if (formData.startDate && formData.endDate && formData.type !== 'stat') {
              const days = calculateBusinessDays(formData.startDate, formData.endDate);
              const suggestedHours = days * HOURS_PER_DAY;
              setFormData({...formData, hours: suggestedHours.toString()});
            }
          };

          const changeYear = (direction) => setSelectedYear(selectedYear + direction);

          const getMonthData = (year, month) => {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            return { daysInMonth: lastDay.getDate(), startingDayOfWeek: firstDay.getDay() };
          };

          const isDateInRange = (date, startDate, endDate) => {
            const d = new Date(date);
            const start = new Date(startDate);
            const end = new Date(endDate);
            return d >= start && d <= end;
          };

          const getTimeOffForDate = (dateString) => {
            return timeOff.filter(item => isDateInRange(dateString, item.startDate, item.endDate));
          };

          const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
          const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

          if (loading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                <div className="text-center">
                  <div className="text-4xl mb-4">‚è≥</div>
                  <div className="text-lg text-gray-700">Loading your data...</div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-3 sm:p-6">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6 mb-4 sm:mb-6">
                  <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 sm:mb-6 gap-3">
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-800 flex items-center gap-2">
                      <Calendar className="text-indigo-600" size={24} />
                      Time Off Tracker
                    </h1>
                    <div className="flex items-center gap-2 sm:gap-4 w-full sm:w-auto justify-between sm:justify-end">
                      <div className="flex items-center gap-2 bg-gray-100 px-4 py-2 rounded-lg">
                        <Clock size={20} className="text-gray-600" />
                        <span className="text-sm font-medium text-gray-700">{HOURS_PER_DAY} hrs/day</span>
                      </div>
                      <div className="flex items-center gap-2 bg-indigo-100 px-3 py-2 rounded-lg">
                        <button onClick={() => changeYear(-1)} className="text-indigo-600 hover:text-indigo-800 transition">
                          <ChevronLeft size={20} />
                        </button>
                        <span className="text-lg font-bold text-indigo-800 min-w-[60px] text-center">{selectedYear}</span>
                        <button onClick={() => changeYear(1)} className="text-indigo-600 hover:text-indigo-800 transition">
                          <ChevronRight size={20} />
                        </button>
                      </div>
                      <button
                        onClick={async () => {
                          await supabase.auth.signOut();
                        }}
                        className="px-3 py-2 bg-red-100 text-red-600 hover:bg-red-200 rounded-lg text-sm font-medium transition"
                      >
                        Logout
                      </button>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6">
                    {['vacation', 'personal', 'floater'].map(type => {
                      const Icon = getTypeConfig(type).icon;
                      const color = getTypeConfig(type).color;
                      const label = getTypeConfig(type).label;
                      const colorMap = { blue: 'border-blue-200 bg-blue-50 border-blue-300 text-blue-600', purple: 'border-purple-200 bg-purple-50 border-purple-300 text-purple-600', amber: 'border-amber-200 bg-amber-50 border-amber-300 text-amber-600' };
                      return (
                        <div key={type} className={`rounded-lg p-3 sm:p-4 border-2 ${colorMap[color]}`}>
                          <div className="flex items-center justify-between mb-2">
                            <div className="flex items-center gap-1 sm:gap-2">
                              <Icon className={`text-${color}-600`} size={18} />
                              <span className="font-semibold text-gray-700 text-sm sm:text-base">{label}</span>
                            </div>
                            <input
                              type="number" step="0.25" value={totals[type]} min="0"
                              onChange={(e) => updateTotals({...totals, [type]: e.target.value === '' ? 0 : parseFloat(e.target.value)})}
                              className={`w-16 sm:w-20 px-1 sm:px-2 py-1 border rounded text-center text-xs sm:text-sm border-${color}-300`}
                            />
                          </div>
                          <div className="space-y-1 sm:space-y-2">
                            <div className="flex justify-between text-xs sm:text-sm">
                              <span className="text-gray-600">Total</span>
                              <span className="font-medium">{hoursToDays(totals[type])} days</span>
                            </div>
                            <div className="flex justify-between text-xs sm:text-sm">
                              <span className="text-gray-600">Used</span>
                              <span className={`text-base sm:text-lg font-bold text-${color}-600`}>{usedHours[type].toFixed(2)} hrs</span>
                            </div>
                            <div className="flex justify-between text-xs sm:text-sm">
                              <span className="text-gray-600">Remaining</span>
                              <span className="text-base sm:text-lg font-bold text-green-600">{hoursToDays(remainingHours[type])} days</span>
                            </div>
                            <div className="text-right text-xs text-gray-500">({remainingHours[type].toFixed(2)} hrs)</div>
                          </div>
                        </div>
                      );
                    })}

                    <div className="bg-green-50 rounded-lg p-3 sm:p-4 border-2 border-green-200">
                      <div className="flex items-center gap-1 sm:gap-2 mb-2">
                        <Gift className="text-green-600" size={18} />
                        <span className="font-semibold text-gray-700 text-sm sm:text-base">Stat Holidays</span>
                      </div>
                      <div className="space-y-1 sm:space-y-2">
                        <div className="text-center py-4 sm:py-6">
                          <div className="text-2xl sm:text-3xl font-bold text-green-600">{statHolidays.length}</div>
                          <div className="text-xs sm:text-sm text-gray-600 mt-1">Scheduled</div>
                        </div>
                        <div className="text-xs text-gray-500 text-center">No deduction from balance</div>
                      </div>
                    </div>
                  </div>

                  {!showForm && (
                    <button onClick={() => setShowForm(true)} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 rounded-lg flex items-center justify-center gap-2 transition">
                      <Plus size={20} />
                      Add Time Off
                    </button>
                  )}

                  {showForm && (
                    <div className="bg-gray-50 rounded-lg p-3 sm:p-4 mb-4">
                      <div className="mb-3 sm:mb-4">
                        <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Time Off Type</label>
                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-2">
                          {[
                            {type: 'vacation', Icon: Sun, label: 'Vacation', shortLabel: 'Vac', color: 'blue'},
                            {type: 'personal', Icon: User, label: 'Personal', shortLabel: 'Pers', color: 'purple'},
                            {type: 'floater', Icon: Star, label: 'Floater', shortLabel: 'Float', color: 'amber'},
                            {type: 'stat', Icon: Gift, label: 'Stat', shortLabel: 'Stat', color: 'green'}
                          ].map(({type, Icon, label, shortLabel, color}) => (
                            <button key={type} type="button"
                              onClick={() => setFormData({...formData, type, hours: type === 'stat' ? '0' : ''})}
                              className={`py-2 px-2 sm:px-4 rounded-lg text-xs sm:text-sm font-medium transition flex items-center justify-center gap-1 sm:gap-2 ${
                                formData.type === type ? `bg-${color}-600 text-white` : `bg-white border-2 border-gray-300 text-gray-700 hover:border-${color}-300`
                              }`}>
                              <Icon size={16} />
                              <span className="hidden sm:inline">{label}</span>
                              <span className="sm:hidden">{shortLabel}</span>
                            </button>
                          ))}
                        </div>
                      </div>
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-3 sm:mb-4">
                        <div>
                          <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Start Date</label>
                          <input type="date" value={formData.startDate}
                            onChange={(e) => {
                              setFormData({...formData, startDate: e.target.value});
                              if (e.target.value && formData.endDate) setTimeout(handleDateChange, 0);
                            }}
                            className="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-md text-sm"
                          />
                        </div>
                        <div>
                          <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">End Date</label>
                          <input type="date" value={formData.endDate}
                            onChange={(e) => {
                              setFormData({...formData, endDate: e.target.value});
                              if (formData.startDate && e.target.value) setTimeout(handleDateChange, 0);
                            }}
                            className="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-md text-sm"
                          />
                        </div>
                      </div>
                      {formData.type !== 'stat' && (
                        <div className="mb-3 sm:mb-4">
                          <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">Hours to Deduct</label>
                          <input type="number" step="0.25" value={formData.hours}
                            onChange={(e) => setFormData({...formData, hours: e.target.value})}
                            placeholder="e.g., 7.75 for 1 day"
                            className="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-md text-sm"
                          />
                          {formData.hours && (
                            <div className="text-xs text-gray-500 mt-1">= {hoursToDays(parseFloat(formData.hours))} days</div>
                          )}
                        </div>
                      )}
                      {formData.type === 'stat' && (
                        <div className="mb-3 sm:mb-4 p-2 sm:p-3 bg-green-50 border border-green-200 rounded-md">
                          <div className="text-xs sm:text-sm text-green-800 flex items-center gap-2">
                            <Gift size={14} />
                            Stat holidays don't deduct from your time off balance
                          </div>
                        </div>
                      )}
                      <div className="mb-3 sm:mb-4">
                        <label className="block text-xs sm:text-sm font-medium text-gray-700 mb-1">
                          Description {formData.type === 'stat' ? '(e.g., Christmas, New Year)' : '(Optional)'}
                        </label>
                        <input type="text" value={formData.description}
                          onChange={(e) => setFormData({...formData, description: e.target.value})}
                          placeholder={formData.type === 'stat' ? 'e.g., Christmas Day' : 'e.g., Beach trip, Family visit'}
                          className="w-full px-2 sm:px-3 py-2 border border-gray-300 rounded-md text-sm"
                        />
                      </div>
                      <div className="flex gap-2">
                        <button type="button" onClick={handleSubmit}
                          className="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 rounded-md transition">
                          Save
                        </button>
                        <button type="button"
                          onClick={() => {
                            setShowForm(false);
                            setFormData({ startDate: '', endDate: '', description: '', type: 'vacation', hours: '' });
                          }}
                          className="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-medium py-2 rounded-md transition">
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}
                </div>

                <div className="bg-white rounded-lg shadow-lg p-4 sm:p-6">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-lg sm:text-xl font-bold text-gray-800">
                      {viewMode === 'list' ? 'Scheduled Time Off' : 'Calendar View'}
                    </h2>
                    <div className="flex gap-2">
                      <button onClick={() => setViewMode('list')}
                        className={`px-3 py-2 rounded-lg flex items-center gap-2 transition text-sm ${
                          viewMode === 'list' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}>
                        <List size={18} />
                        <span className="hidden sm:inline">List</span>
                      </button>
                      <button onClick={() => setViewMode('calendar')}
                        className={`px-3 py-2 rounded-lg flex items-center gap-2 transition text-sm ${
                          viewMode === 'calendar' ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}>
                        <CalendarDays size={18} />
                        <span className="hidden sm:inline">Calendar</span>
                      </button>
                    </div>
                  </div>

                  {viewMode === 'list' ? (
                    <div className="space-y-2 sm:space-y-3">
                      {timeOff.length === 0 ? (
                        <div className="text-center py-8 text-gray-500">
                          No time off scheduled yet. Click "Add Time Off" to get started!
                        </div>
                      ) : (
                        timeOff.map((item) => {
                          const config = getTypeConfig(item.type);
                          const Icon = config.icon;
                          return (
                            <div key={item.id}
                              className={`flex flex-col sm:flex-row items-start sm:items-center justify-between p-3 sm:p-4 bg-${config.color}-50 rounded-lg border-2 border-${config.color}-200 hover:shadow-md transition gap-2 sm:gap-0`}>
                              <div className="flex items-center gap-2 sm:gap-3 flex-1 w-full">
                                <Icon className={`text-${config.color}-600 flex-shrink-0`} size={20} />
                                <div className="flex-1 min-w-0">
                                  <div className="flex flex-wrap items-center gap-1 sm:gap-2 mb-1">
                                    <span className={`text-xs font-semibold px-2 py-1 rounded bg-${config.color}-200 text-${config.color}-800`}>
                                      {config.label}
                                    </span>
                                    <span className="font-medium text-gray-800 text-sm sm:text-base break-words">
                                      {item.startDate === item.endDate ? `on ${formatDate(item.startDate)}` : `${formatDate(item.startDate)} ‚Üí ${formatDate(item.endDate)}`}
                                    </span>
                                  </div>
                                  {item.description && (
                                    <div className="text-xs sm:text-sm text-gray-600 break-words">{item.description}</div>
                                  )}
                                </div>
                              </div>
                              <div className="flex items-center gap-3 sm:gap-4 w-full sm:w-auto justify-between sm:justify-end">
                                {item.type !== 'stat' ? (
                                  <div className="text-right">
                                    <div className={`font-bold text-${config.color}-600 text-sm sm:text-base`}>
                                      {item.hours.toFixed(2)} hrs
                                    </div>
                                    <div className="text-xs text-gray-500">
                                      ({hoursToDays(item.hours)} days)
                                    </div>
                                  </div>
                                ) : (
                                  <div className="text-right">
                                    <div className="font-bold text-green-600 text-sm sm:text-base">No deduction</div>
                                    <div className="text-xs text-gray-500">Stat holiday</div>
                                  </div>
                                )}
                                <button onClick={() => deleteTimeOff(item.id)}
                                  className="text-red-500 hover:text-red-700 transition flex-shrink-0">
                                  <Trash2 size={18} />
                                </button>
                              </div>
                            </div>
                          );
                        })
                      )}
                    </div>
                  ) : (
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                      {months.map((monthName, monthIndex) => {
                        const { daysInMonth, startingDayOfWeek } = getMonthData(selectedYear, monthIndex);
                        return (
                          <div key={monthIndex} className="bg-white rounded-lg border-2 border-gray-200 p-3">
                            <h3 className="text-center font-bold text-gray-800 mb-2 text-sm">{monthName}</h3>
                            <div className="grid grid-cols-7 gap-1">
                              {dayNames.map(day => (
                                <div key={day} className="text-center text-xs font-semibold text-gray-600 py-1">{day[0]}</div>
                              ))}
                              {Array.from({ length: startingDayOfWeek }).map((_, i) => (
                                <div key={`empty-${i}`} className="aspect-square"></div>
                              ))}
                              {Array.from({ length: daysInMonth }).map((_, dayIndex) => {
                                const day = dayIndex + 1;
                                const dateString = `${selectedYear}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                const timeOffItems = getTimeOffForDate(dateString);
                                const dayOfWeek = new Date(selectedYear, monthIndex, day).getDay();
                                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                                return (
                                  <div key={day}
                                    className={`aspect-square flex items-center justify-center text-xs rounded relative ${
                                      isWeekend ? 'bg-gray-100' : 'bg-white'
                                    }`}>
                                    <span className={`z-10 relative ${timeOffItems.length > 0 ? 'font-bold text-white' : 'text-gray-700'}`}>
                                      {day}
                                    </span>
                                    {timeOffItems.length > 0 && (
                                      <div className="absolute inset-0 rounded overflow-hidden">
                                        {timeOffItems.map((item, idx) => {
                                          const config = getTypeConfig(item.type);
                                          const colorMap = { blue: 'bg-blue-500', purple: 'bg-purple-500', amber: 'bg-amber-500', green: 'bg-green-500' };
                                          return (
                                            <div key={item.id}
                                              className={`absolute inset-0 ${colorMap[config.color]} opacity-80`}
                                              style={{ top: `${idx * (100 / timeOffItems.length)}%`, height: `${100 / timeOffItems.length}%` }}
                                            />
                                          );
                                        })}
                                      </div>
                                    )}
                                  </div>
                                );
                              })}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>